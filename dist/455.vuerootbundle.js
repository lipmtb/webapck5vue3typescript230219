"use strict";(self.webpackChunkvue3webpack5_2022100601=self.webpackChunkvue3webpack5_2022100601||[]).push([[455,829],{8953:function(e,t,a){var o=a(4783)(e.id,{locals:!1});e.hot.dispose(o),e.hot.accept(void 0,o)},9166:function(e,t,a){var o=a(4783)(e.id,{locals:!1});e.hot.dispose(o),e.hot.accept(void 0,o)},9639:function(e,t,a){var o=a(4783)(e.id,{locals:!1});e.hot.dispose(o),e.hot.accept(void 0,o)},7127:function(e,t,a){a.r(t),a.d(t,{default:function(){return q}});var o=a(6252);const n={class:"chat-learn-layout"};var i=a(2262),s=a(4949),l=a(1223),c=a(4468);const r={class:"login-header"},u={key:0,class:"login-btn"};var d=(0,o.aZ)({props:{userName:{type:String,require:!1}},setup(e,t){return{userName:(0,i.Vh)(e,"userName")}},methods:{openlogin(){this.$emit("loginOpen")}}}),p=(a(9639),a(3744)),m=(0,p.Z)(d,[["render",function(e,t,a,n,i,s){return(0,o.wg)(),(0,o.iD)("div",r,[e.userName?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",u,[(0,o._)("button",{onClick:t[0]||(t[0]=(...t)=>e.openlogin&&e.openlogin(...t)),class:"login-regist-btn"},"登录")]))])}],["__scopeId","data-v-35a30560"]]),g=a(3577),h=a(9963);const v={class:"chat-wrapper"},b={key:0,class:"page-welcome"},w={class:"default-page",ref:"defaultPageRef"},y={ref:"firstEle",style:{"{opacity":"0,height:0}"}},f={class:"chat-send-footer",ref:"footerSendRef"},C=["disabled"],I={class:"voiceList"},D=["textContent"],_=(0,o.Uk)(),k=["src"],L={class:"confirm-name"};var A=a(9286);const V={key:0,class:"chat-owner"},N={class:"send-time"},S={class:"from-user"},H={key:1,class:"chat-from"},R={class:"from-user"},K={class:"send-time"},T={key:2,class:"content-owner"},x={class:"content-desc"},M={class:"botContentList"};var Z=(0,o.aZ)({name:"chatDetail",props:{chatItem:{type:Object,default:{}},userId:String},setup(e){const t=(0,i.Vh)(e,"chatItem"),a=(0,i.Vh)(e,"userId"),n=(0,o.Fl)((()=>{if("assistant"===t?.value?.userId){const e=t?.value?.content;return e.split(/```|。|：/).map((e=>({splitContent:e})))}return[]}));return{chatItemData:t,userIdRef:a,botContentArray:n,copyTextToSnipase:e=>{console.log("event",e);const t=e?.target;if(!t)return;const a=(e=>{if("ul"===e?.nodeName)return e;let t=e;for(;t?.parentElement&&(t=t?.parentElement,console.log("resultElement?.nodeName ",t?.nodeName),"UL"!==t?.nodeName););return t})(t);(e=>{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)})(a.innerText),alert("复制成功")}}}});a(9166);var j=(0,p.Z)(Z,[["render",function(e,t,a,n,i,s){return(0,o.wg)(),(0,o.iD)("div",{class:(0,g.C_)(["chat-detail-item",{assistant:"assistant"===e.chatItemData.userId}])},[e.userIdRef===e.chatItemData.userId?((0,o.wg)(),(0,o.iD)("div",V,[(0,o._)("span",N,(0,g.zw)(e.chatItemData.time),1),(0,o._)("span",S,(0,g.zw)(e.chatItemData.userName),1)])):((0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("span",R,(0,g.zw)(e.chatItemData.userName),1),(0,o._)("span",K,(0,g.zw)(e.chatItemData.time),1)])),e.userIdRef===e.chatItemData.userId?((0,o.wg)(),(0,o.iD)("div",T,[(0,o._)("span",x,(0,g.zw)(e.chatItemData.content),1)])):((0,o.wg)(),(0,o.iD)("div",{key:3,class:"content-other",onClick:t[0]||(t[0]=(...t)=>e.copyTextToSnipase&&e.copyTextToSnipase(...t))},[(0,o._)("ul",M,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.botContentArray,(e=>((0,o.wg)(),(0,o.iD)("li",null,[(0,o._)("span",null,(0,g.zw)(e.splitContent),1)])))),256))])]))],2)}],["__scopeId","data-v-6d5a2999"]]),O=a(5133),B=()=>{const e=(0,l.oR)(),t=(0,i.iH)(),a=(0,i.qj)({loading:!1,chatList:[]}),n=(0,o.Fl)((()=>e.getters["userArea/getUserId"])),s=(0,o.Fl)((()=>e.getters["userArea/getUserName"]));return{...a||{},socketRef:t,onSubmitChat:async(e,t)=>{a.loading=!0,a.chatList.push({userId:n?.value,userName:s?.value,time:(new Date).toLocaleTimeString(),content:e});try{const i=(await(o={userId:n?.value,content:e,apiKey:t},O.Z.post("/chatai/gptai",{...o})))?.choices?.[0]?.message?.content;a.chatList.push({userId:"assistant",userName:"bot",time:(new Date).toLocaleTimeString(),content:i??""})}catch(e){console.error("发送失败",e)}finally{a.loading=!1}var o},userId:n}},U=(0,o.aZ)({name:"ChatMain",props:{userName:String},setup(e){const t=(0,l.oR)(),{userId:a,loading:n,chatList:s,onSubmitChat:c}=B(),{openApiModal:r,closeApiModal:u,apiKeyVisible:d,apiKey:p,onApiConfirm:m,onApiReset:g}=(()=>{const e=(0,l.oR)(),t=(0,i.iH)(),a=(0,i.iH)(!1);return{apiKey:t,setApiKey:e=>{t.value=e},apiKeyVisible:a,openApiModal:()=>{a.value=!0},closeApiModal:()=>{a.value=!1},onApiReset:()=>{t.value=""},onApiConfirm:()=>{t?.value&&(e.dispatch("apiKeyArea/saveApiKeyAction",{key:t.value}),a.value=!1)}}})(),h=(0,i.iH)(),v=(0,i.iH)(),b=(0,i.iH)(),w=(0,i.iH)(),{calcScrollHeight:y}=((e,t)=>{const a=(0,i.iH)(0);return(0,o.m0)((()=>{e?.value||(a.value=0);const o=e?.value?.getBoundingClientRect?.(),n=t?.value?.getBoundingClientRect?.();a.value=Number(o?.top||0)-Number(n?.top||0)})),{calcScrollHeight:a}})(h,v),f=(0,o.Fl)((()=>t.getters["apiKeyArea/getApiKey"])),C=(0,i.iH)(),I=(0,o.Fl)((()=>!C?.value||n||!a?.value)),D=(0,i.Vh)(e,"userName");(0,o.m0)((()=>{const e=s.find((e=>"assistant"===e?.userId));(0,o.Y3)((()=>{const t=b?.value,a=w?.value;if(!t||!e)return;const o=t.querySelectorAll(".assistant"),n=o?.[o.length-1];if(!n||!a)return;const i=n.getBoundingClientRect?.()?.top-a?.getBoundingClientRect?.()?.top;t.scrollTo({top:i})}))}));const{startVoice:_,endVoice:k,voiceList:L}=(()=>{const e=(0,i.iH)([]);return(0,i.iH)(""),{startVoice:()=>{console.log("开始录音js"),window.postWithCallback&&window.postWithCallback("recordVoice",{type:"start"},(e=>{console.log("开始录音response",typeof e,JSON.stringify(e))}))},endVoice:()=>{window.postWithCallback&&window.postWithCallback("recordVoice",{type:"end"},(async t=>{if(console.log("结束录音response"),"object"==typeof t){console.log("获取到录音数据",t),t&&t.audioBase64||console.log("录音异常"),console.log("录音成功",t.audioBase64);const a="data:audio/aac;base64,"+t.audioBase64,o=await(async(e,t)=>e?await fetch(`data:${t};base64,${e}`).then((e=>e.blob())):new Blob([],{type:t}))(t.audioBase64,"audio/aac");e.value=[{time:(new Date).toLocaleTimeString(),voiceUrl:a,originFile:o}]}}))},voiceList:e,removeVoice:()=>{e.value=[]}}})();return{userName:D,userInText:C,handleSubmit:async()=>{a?.value?n?alert("请稍等"):C?.value?f?.value?(await c(C?.value,f?.value),C.value=""):r():alert("请先输入问题"):alert("请先登录")},btnDisabled:I,chatList:s,userId:a,apiKey:p,apiKeyVisible:d,onApiConfirm:m,closeApiModal:u,onApiReset:g,footerSendRef:h,defaultPageRef:v,calcScrollHeight:y,scrollLine:b,firstEle:w,startVoice:_,endVoice:k,voiceList:L}},components:{ChatDetail:j,Modal:A.Z}});a(8953);var W=(0,p.Z)(U,[["render",function(e,t,a,n,i,s){const l=(0,o.up)("ChatDetail"),c=(0,o.up)("Modal");return(0,o.wg)(),(0,o.iD)("div",v,[e.userName?((0,o.wg)(),(0,o.iD)("p",b,"你好！"+(0,g.zw)(e.userName),1)):(0,o.kq)("",!0),(0,o._)("div",w,[(0,o._)("div",{ref:"scrollLine",class:"chat-scroll-list",style:(0,g.j5)({height:e.calcScrollHeight+"px"})},[(0,o._)("div",y,null,512),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.chatList,(t=>((0,o.wg)(),(0,o.j4)(l,{"chat-item":t,"user-id":e.userId,key:t.time},null,8,["chat-item","user-id"])))),128))],4),(0,o._)("div",f,[(0,o.wy)((0,o._)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.userInText=t),class:"input-area",placeholder:"请输入您的问题",cols:"2",onSubmit:t[1]||(t[1]=(...t)=>e.handleSubmit&&e.handleSubmit(...t))},null,544),[[h.nr,e.userInText]]),(0,o._)("button",{class:(0,g.C_)(["chat-submit-btn",e.btnDisabled?"disalbed-btn":""]),onClick:t[2]||(t[2]=(...t)=>e.handleSubmit&&e.handleSubmit(...t)),disabled:e.btnDisabled},"发送",10,C),(0,o._)("button",{class:"chat-voice-btn",onTouchstart:t[3]||(t[3]=(0,h.iM)(((...t)=>e.startVoice&&e.startVoice(...t)),["prevent"])),onTouchend:t[4]||(t[4]=(0,h.iM)(((...t)=>e.endVoice&&e.endVoice(...t)),["prevent"]))},"语音输入",32),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.voiceList,((e,t)=>((0,o.wg)(),(0,o.iD)("ul",I,[(0,o._)("li",null,[(0,o._)("span",{textContent:(0,g.zw)(t)},null,8,D),_,(0,o._)("audio",{src:e.voiceUrl,controls:""},null,8,k)])])))),256))],512)],512),e.apiKeyVisible?((0,o.wg)(),(0,o.j4)(c,{key:1,"on-close":e.closeApiModal},{"modal-content":(0,o.w5)((()=>[(0,o._)("div",L,[(0,o.wy)((0,o._)("input",{type:"text",placeholder:"请输入apiKey","onUpdate:modelValue":t[5]||(t[5]=t=>e.apiKey=t)},null,512),[[h.nr,e.apiKey]])])])),"modal-bottom":(0,o.w5)((()=>[(0,o._)("button",{onClick:t[6]||(t[6]=(...t)=>e.onApiConfirm&&e.onApiConfirm(...t))},"确定"),(0,o._)("button",{onClick:t[7]||(t[7]=(...t)=>e.onApiReset&&e.onApiReset(...t))},"重置")])),_:1},8,["on-close"])):(0,o.kq)("",!0)])}],["__scopeId","data-v-47435b98"]]),z=a(2364),F=(0,o.aZ)({setup(){const e=(0,l.oR)(),t=(0,s.tv)(),a=(0,i.iH)(!1);return{userObj:(0,o.Fl)((()=>({userName:e.getters["userArea/getUserName"]}))),loginOpen:()=>{a.value=!0},loginVisible:a,onCloseLogin:()=>{a.value=!1},toDownloadPage:()=>{t.push("/chatLearn/downloadPage")}}},components:{PopupLayout:c.Z,LoginHeaderVue:m,ChatMain:W,Login:z.default}}),q=(0,p.Z)(F,[["render",function(e,t,a,i,s,l){const c=(0,o.up)("LoginHeaderVue"),r=(0,o.up)("ChatMain"),u=(0,o.up)("Login"),d=(0,o.up)("router-view"),p=(0,o.up)("PopupLayout");return(0,o.wg)(),(0,o.iD)("div",n,[(0,o.Wm)(p,null,{children:(0,o.w5)((()=>[(0,o.Wm)(c,{"user-name":e.userObj?.userName,onLoginOpen:e.loginOpen},null,8,["user-name","onLoginOpen"]),(0,o.Wm)(r,{"user-name":e.userObj?.userName},null,8,["user-name"]),(0,o.Wm)(u,{visible:e.loginVisible,"on-close":e.onCloseLogin},null,8,["visible","on-close"]),(0,o.Wm)(d)])),_:1})])}]])}}]);
//# sourceMappingURL=455.vuerootbundle.js.map